import csv

# PSV 版本中含有大量特殊代码
# 如 「<・>私|<・>に|<・>と|<・>っ|<・>て|、過ごしやすい環境を作ってくれること」, 这里面 <・>x|<・>x 的格式可能是一种特殊渲染
# 如 @w9@h9, @w1@h1, 应该是加粗等处理

# 注: PSV 版本中删去了原本 娼馆, 娼妇 的定义, 在后续校对过程中要进行纠正, 重点搜索 娼馆, 娼妇
# 原始 娼馆 大多修改成了 莉莉乌姆, 娼妇 改成了 女人, 重点搜 娼馆
# 凯伊姆作为男妓的相关文案要么被删除, 要么进行内容修改, 重点搜索 男妓
# 凯伊姆 被男人骑的相关文案也进行了调整, 重点搜索 骑 字, 然后对照日语原文
# 毒品 也被替换了, 大多都被替换成了 药物, 重点搜 毒品
# 迷药 也被替换了, 大多都被替换成了 药, 重点搜 迷药
# 乞丐 内容存在变化, 大多跟乞丐相关的文案内容进行删除, 跟乞丐相关的名词会删除掉乞丐二字, 重点搜 乞丐

# 关于错别字:
# 罗嗦 => 啰嗦

# 人名对照表
check_map = {
    "【不蝕金鎖の男】": "【不蚀金锁成员】",
    "【中年の男】": "【中年乞丐】",  # 【中年男人】
    "【女の主】": "【主人】",
    "【坊主の男】": "【光头男人】",
    "【ラング副隊長】": "【兰格副队长】",
    "【ラング】": "【兰格】",
    "【カイム】": "【凯伊姆】",
    "【カイム＆ジーク】": "【凯伊姆＆吉克】",
    "【ジーク】": "【吉克】",
    "【ただのジーク】": "【吉克的声音】",
    "【中年の見物客】": "【围观的中年人】",
    "【派手な女見物客】": "【围观的女人】",
    "【太った羽狩り】": "【壮实的羽狩】",
    "【太鼓腹の酔客】": "【大肚子的醉汉】",
    "【ヒゲの酔客】": "【大胡子醉汉】",
    "【オズ】": "【奥兹】",
    "【女】": "【女】",
    "【女性の声】": "【女声】",
    "【店主】": "【店主】",
    "【少女】": "【少女】",
    "【少女の声】": "【少女声】",
    "【若い男】": "【年轻人】",
    "【クローディア】": "【库罗蒂雅】",
    "【柄の悪い見物客】": "【惊慌的观众】",
    "【羽が折れた少女】": "【折翼的少女】",
    "【メルト】": "【梅尔特】",
    "【鼻血を流している男】": "【流着鼻血的男人】",
    "【痩せた羽狩り】": "【消瘦的羽狩】",
    "【フィオネ隊長】": "【菲奥奈队长】",
    "【フィオネ】": "【菲奥奈】",
    "【覆面の男】": "【蒙面男人】",
    "【薄汚れた男】": "【邋遢的男人】",
    "【部下】": "【部下】",
    "【酔客】": "【醉酒的顾客】",
    "【アイリス】": "【阿伊莉斯】",
    "【付き人】": "【随从】",
    "【高い男の声】": "【高挑的男人】",
    "【ルキウス】": "【鲁基乌斯】",
    "【鷲鼻の羽狩り】": "【鹰钩鼻的羽狩】",
    "【？？】": "【？？】",
    "【エリス】": "【艾莉斯】",
    "【神官】": "【神官】",
    "【ゴツい見物客】": "【粗鲁的观众】",
    "【男】": "【男人】",
    "【羽つきの少年】": "【羽化病患少年】",
    "【羽狩りの指揮者】": "【羽狩的队长】",
    "【赤毛の羽狩り】": "【红发的羽狩】",
    "【羽狩りの副隊長】": "【羽狩的副队长】",
    "【羽狩りの隊長】": "【羽狩的队长】",
    "【リサ】": "【莉莎】",
    "【太った男】": "【胖男人】",
    "【ティア】": "【缇娅】",
    "【太い男の声】": "【肥胖的男人】",
    "【男の声】": "【男声】",
    "【リシア】": "【莉西亚】",
    "【猫背の男】": "【驼背男人】",
    "【太った女】": "【胖女人】",
    "【神経質そうな女】": "【神经质的女人】",
    "【薄汚いガキ】": "【邋遢的小鬼】",
    "【痩せた老婆】": "【瘦弱的婆婆】",
    "【女の声】": "【女声】",
    "【中年の野次馬】": "【中年的起哄者】",
    "【ゴツい野次馬】": "【粗鲁的起哄者】",
    "【黒羽】": "【黑羽】",
    "【不蝕金鎖の若い男】": "【不蚀金锁的年轻人】",
    "【羽狩りたち】": "【羽狩们】",
    "【不蝕金鎖の幹部たち】": "【不蚀金锁的干部们】",
    "【クーガー】": "【库格尔】",
    "【若い羽狩り】": "【年轻的羽狩】",
    "【ルキウス卿】": "【鲁基乌斯卿】",
    "【副官】": "【副官】",
    "【厚化粧の女】": "【浓妆的娼妇】",  # 【浓妆的女人】
    "【常連の男】": "【常客】",
    "【ベルナド】": "【贝尔纳德】",
    "【サイ】": "【萨伊】",
    "【システィナ】": "【西斯狄娜】",
    "【唇の薄い男】": "【薄唇的男人】",
    "【鯰顔の売人】": "【贩药商人】",
    "【アイム】": "【阿伊姆】",
    "【短髪の男】": "【短发男】",
    "【片目の男】": "【独眼男】",
    "【ヒゲの男】": "【胡茬男】",
    "【眉のない男】": "【无眉男】",
    "【顎の出た男】": "【大脖男】",
    "【精悍な男】": "【精悍男人】",
    "【薄汚れた少女】": "【邋遢的少女】",
    "【やつれた少女】": "【憔悴的少女】",
    "【ラヴィリア】": "【拉菲莉亚】",
    "【謎の主】": "【寄信人】",
    "【酒場の客】": "【酒馆客人】",
    "【酔っぱらいの男】": "【醉酒的顾客】",
    "【聖職者】": "【圣职者】",
    "【ナダル】": "【纳达尔】",
    "【聖職者たち】": "【圣职者们】",
    "【ギルバルト】": "【吉尔巴鲁特】",
    "【背の低い聖職者】": "【驼背的圣职者】",
    "【痩せぎすの聖職者】": "【消瘦的圣职者】",
    "【無愛想な店主】": "【冷淡的店长】",
    "【集まった住民】": "【聚集的居民们】",
    "【聖女】": "【圣女】",
    "【初代イレーヌ】": "【初代圣女】",
    "【先代の聖女】": "【先代圣女】",
    "【住民】": "【居民】",
    "【虚ろな目の男】": "【绝望的男人】",
    "【無精髭の男】": "【颓废的男人】",
    "【牢獄の住民】": "【牢狱的住民】",
    "【コレット】": "【柯蕾特】",
    "【衛兵】": "【卫兵】",
    "【果物屋の客】": "【水果店的客人】",
    "【御者の男】": "【驾车男人】",
    "【ギルバルト卿】": "【吉尔巴鲁特卿】",
    "【近衛兵】": "【近卫兵】",
    "【鎧姿の男】": "【铠甲武士】",
    "【小さな召使い】": "【年幼的女佣】",
    "【ヴァリアス】": "【法利亚斯】",
    "【ヴァリアスの妻】": "【法利亚斯的妻子】",
    "【リシア王女】": "【莉西亚王女】",  # 【莉西亚公主】
    "【召使い】": "【佣人】",
    "【ガウ】": "【戈尔】",
    "【料理長】": "【厨师长】",
    "【庭師の老人】": "【园艺师老人】",
    "【老人】": "【老人】",
    "【ネヴィル】": "【奈菲尔】",
    "【ネヴィル卿】": "【奈菲尔卿】",
    "【御者の親父】": "【马车夫】",
    "【露店の店主】": "【街边店店主】",
    "【子供】": "【乞讨的孩子】",  # 【孩子】
    "【少年】": "【少年】",
    "【坊主頭の羽狩り】": "【追捕的羽狩】",  # 【光头羽狩】
    "【国王】": "【国王】",
    "【中年の近衛兵】": "【中年的近卫兵】",
    "【若い近衛兵】": "【年轻近位兵】",
    "【近衛騎士団】": "【近卫骑士团】",
    "【痩せた兵士】": "【瘦弱的士兵】",
    "【壮年の貴族】": "【壮年的贵族】",
    "【研究員】": "【研究员】",
    "【研究者】": "【研究员】",
    "【痩せた研究員】": "【消瘦的研究员】",
    "【若い貴族】": "【年轻贵族】",
    "【貴族】": "【贵族】",
    "【母親】": "【母亲】",
    "【仮面の人物】": "【假面人】",
    "【主治医】": "【御医长】",
    "【大柄な男】": "【壮汉】",
    "【痩せた男】": "【瘦弱男人】",
    "【筋肉質の男】": "【肌肉男】",
    "【でかい賊の男】": "【土匪般的男人】",
    "【賊の男】": "【男人】",
    "【怪我をした男】": "【受伤的男人】",
    "【蓬髪の男】": "【蓬头的乞丐】",  # 【蓬头的男人】
    "【隻眼の男】": "【独眼的乞丐】",  # 【独眼的男人】
    "【殺気だった男の声】": "【充满杀气的男声】",
    "【苦しそうな男の声】": "【痛苦的男声】",
    "【信心深い牢獄民】": "【受鼓舞的牢狱民】",
    "【怪我をした牢獄民】": "【受伤的牢狱民】",
}

csv_file = "game_script/translate.csv"

with open(csv_file, newline='', encoding='utf-8') as f:
    reader = csv.reader(f)
    for i, row in enumerate(reader, start=1):
        original = row[0].strip()
        translation = row[1].strip()

        if translation is None or translation == "":
            print(f"无更多内容 ==> 行号: {i}")
            break

        # 规则 1: 【xxx】
        if original.startswith("【") and original.endswith("】"):
            value = check_map.get(original, "")
            if value == "":
                print(f"行 {i} 异常, {original} 不存在")
                print(f"{original} <==> {translation}")
                break
            if translation != value:
                print(f"行 {i} 异常 【xxx】规则")
                print(f"{original} <==> {translation}")
                break
            continue

        # 规则 2: 「xxx」
        if original.startswith("「") and original.endswith("」"):
            if not (translation.startswith("「") and translation.endswith("」")):
                print(f"行 {i} 异常 「xxx」规则")
                print(f"{original} <==> {translation}")
                break
            continue

        # 规则 3: @w9@h9 或 @w1@h1 开头
        if original.startswith("@w9@h9") or original.startswith("@w1@h1"):
            if not (translation.startswith("@w9@h9") or translation.startswith("@w1@h1")):
                print(f"行 {i} 异常 @w开头规则")
                print(f"{original} <==> {translation}")
                break
            # 后面跟着「xxx」，再检查
            rest_original = original.split("@", 3)[-1]  # 取后半部分
            rest_translation = translation.split("@", 3)[-1]
            if (rest_original.startswith("「") and rest_original.endswith("」")):
                if not (rest_translation.startswith("「") and rest_translation.endswith("」")):
                    print(f"行 {i} 异常 @w后跟「xxx」规则")
                    print(f"{original} <==> {translation}")
                    break
            continue

        # 规则 4: 其他情况
        if (
                (not original.startswith("【") and not original.endswith("】") and not translation.startswith(
                    "【") and not translation.endswith("】"))
                and
                (not original.startswith("「") and not original.endswith("」") and not translation.startswith(
                    "「") and not translation.endswith("」"))
                # and
                # (not original.startswith("『") and not original.endswith("』") and not translation.startswith(
                #     "『") and not translation.endswith("』"))
        ):
            continue
        else:
            # 有些情况是引用话语, 结尾处会用括号, 只要保障两段一致即可
            if (
                    (
                            not original.startswith("【") and original.endswith("】") and
                            not translation.startswith("【") and translation.endswith("】")
                    )
                    or
                    (
                            not original.startswith("「") and original.endswith("」") and
                            not translation.startswith("「") and translation.endswith("」")
                    )
            ):
                continue

            print(f"行 {i} 异常 其他规则")
            print(f"{original} <==> {translation}")
            break
